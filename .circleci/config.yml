version: 2
jobs:
  test:
    machine:
      services: docker
    environment:
      - DISTRO: centos8
      - DISTRO: centos7
      - DISTRO: centos6
      - DISTRO: ubuntu1804
      - DISTRO: ubuntu1604
      - DISTRO: debian10
      - DISTRO: debian9
    steps:
      - checkout
      - run: |
          sudo apt-get update -y
          sudo apt-get install software-properties-common 
          sudo add-apt-repository ppa:deadsnakes/ppa
          sudo apt-get install python3.7 -y
          sudo apt-get install python3-pip -y
          pip3 install --upgrade pip
          pip3 install docker==3.4.1
          pip3 install molecule ansible-lint yamllint
          mkdir ~/ansible-role-terraform
          mv ~/project/ ~/ansible-role-terraform
          cd ~/ansible-role-terraform          
          ls -la -F
          MOLECULE_DISTRO=$DISTRO molecule test      
workflows:
  version: 2
  build_and_test:
    jobs:
      - test
